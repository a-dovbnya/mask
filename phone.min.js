!function(t){var e={init:function(){var e=t(this),r=new a;e.val(""),e.on("keypress",function(t){if(r.charCode=t.charCode,r.charSymbol=String.fromCharCode(t.charCode),r.checkSymbol(t.charCode)){if(textComponent=t.target,selectedText="",void 0!=textComponent.selectionStart){var e=textComponent.selectionStart,a=textComponent.selectionEnd;selectedText=textComponent.value.substring(e,a),r.startPos=e}selectedText.length>0&&(selectedText.length==r.formattedVal.length?(r.val="",r.formattedVal=""):(r.selectedSubstr=selectedText,r.endPos=a))}}),e.on("keydown",function(t){if(46==t.keyCode){if(l=t.target,o="",void 0!=l.selectionStart){var e=l.selectionStart,a=l.selectionEnd;if((o=l.value.substring(e,a)).length>0)r.deleteSubstr(o,e,a-e);else{s=r.getCaretPos(t.target);"-"==(i=r.formattedVal[s])||"("==i||")"==i||(r.deleteSymbol(s,!0),r.formattedVal=r.strFormatted(r.val,r.activeMask),0!=r.formattedVal&&(r.charCode=0,r.charSymbol=0)),r.caretMoveFlag=!0,r.caretPos=s,r.caretMoveUp=!0}}}else if(8==t.keyCode){var o,l=t.target;if(void 0!=l.selectionStart){var e=l.selectionStart,a=l.selectionEnd;o=l.value.substring(e,a)}if(o.length>0)r.deleteSubstr(o,e,a-e);else{var s=r.getCaretPos(t.target),i=r.formattedVal[s-1];"-"==i||"("==i||")"==i?(r.charCode=0,r.charSymbol=0):(r.deleteSymbol(s),r.formattedVal=r.strFormatted(r.val,r.activeMask),0!=r.formattedVal&&(r.charCode=0,r.charSymbol=0)),r.caretMoveFlag=!0,r.caretPos=s}}}),e.on("input",function(t){charCode=r.charCode,charSymbol=r.charSymbol,0!=charCode?(0==r.val.length?r.checkSymbol(charCode,!0)&&(r.selectMask(charCode),r.formattedVal=!0,57==charCode&&(r.val+=String(r.charSymbol))):r.val.length<r.limitSymbol&&0==r.selectedSubstr.length&&(r.checkSymbol(charCode)?(1==r.val.length&&57==charCode||r.val.length>1)&&(r.startPos==r.formattedVal.length?r.val+=String(charSymbol):r.val.length==r.limitSymbol||(r.insertSymbol(),r.caretMoveFlag=!0,r.caretPos=r.startPos,r.caretMoveUp=!0)):e.val("")),r.val.length<=r.limitSymbol&&r.selectedSubstr.length>0&&r.checkSymbol(charCode)&&r.deleteSubstr(r.selectedSubstr,r.startPos,r.endPos-r.startPos,String(r.charSymbol)),void 0==r.val&&(r.val=""),r.formattedVal=r.strFormatted(r.val,r.activeMask),0!=r.formattedVal?e.val(r.formattedVal):43!=r.charCode&&(r.formattedVal="",e.val(r.formattedVal))):0!=r.formattedVal.length&&(0==r.formattedVal&&(r.formattedVal=""),e.val(r.formattedVal)),r.caretMoveFlag&&r.caretPos>0&&(r.caretMoveUp?t.target.setSelectionRange(r.caretPos+1,r.caretPos+1):t.target.setSelectionRange(r.caretPos-1,r.caretPos-1),r.caretMoveFlag=!1,r.caretPos=0,r.caretMoveUp=!1)})}},a=function(){return{maskOne:"+x (xxx) xxx-xx-xx",maskTwo:"+7 (xxx) xxx-xx-xx",maskThree:"x (xxx) xxx-xx-xx",maskFour:"(xxx) xxx-xx-xx",maskFive:"+xxxxxxxxxxxx",activeMask:"",allowCharCode:[48,49,50,51,52,53,54,55,56,57],allowCharCodeFirst:[40,41,43],charCode:0,charSymbol:0,val:"",caretMoveFlag:!1,caretPos:0,caretMoveUp:!1,formattedVal:"",selectedSubstr:"",startPos:0,endPos:0,limitSymbol:11,checkSymbol:function(t,e){if(t){for(var a=!1,r=0;r<this.allowCharCode.length;r++)if(t==this.allowCharCode[r])return a=!0;if(e)for(var o=0;o<this.allowCharCodeFirst.length;o++)t==this.allowCharCodeFirst[o]&&(a=!0);return a}},selectMask:function(t){43!=t&&55!=t&&56!=t&&57!=t||(this.activeMask=this.maskOne,this.limitSymbol=11,this.val+="7")},strFormatted:function(t,e){if(t.length>0&&e.length>0){for(var a="",r=0,o=0;o<e.length;o++)if("x"==e[o]){if(void 0==t[r])break;a+=t[r],r++}else a+=e[o];return a}return!1},getCaretPos:function(t){if(t.selectionStart)return t.selectionStart;if(document.selection){t.focus();var e=document.selection.createRange();if(null==e)return 0;var a=t.createTextRange(),r=a.duplicate();return a.moveToBookmark(e.getBookmark()),r.setEndPoint("EndToStart",a),r.text.length}return 0},deleteSymbol:function(t,e){if(this.activeMask.length>0){for(var a=this.activeMask.split(""),r=0,o=0;o<t&&("x"==a[o]&&r++,0!=t);o++);var l=this.val.split(""),s="";e?l.splice(r,1):l.splice(r-1,1);for(o=0;o<l.length;o++)s+=l[o];this.val=s}},deleteSubstr:function(t,e,a,r){if(t.length>0){var o,l=this.formattedVal,s="",i=(this.activeMask,!1);if((l=l.split("")).splice(e,a),r){o=t.split("");for(c=0;c<o.length;c++)if(!isNaN(parseInt(o[c]))){i=!0;break}if(!i)return;l.splice(e,0,r)}for(var c=0;c<l.length;c++)isNaN(parseInt(l[c]))||(s+=l[c]);this.val=s,this.formattedVal=this.strFormatted(this.val,this.activeMask),this.charCode=0,this.charSymbol=0,this.caretMoveFlag=!1,this.selectedSubstr="",this.endPos=0}},insertSymbol:function(){var t=this.formattedVal;if(t.length>1){var e="",a=(this.activeMask,t.split(""));a.splice(this.startPos,0,String(this.charSymbol));for(var r=0;r<a.length;r++)isNaN(parseInt(a[r]))||(e+=a[r]);this.val=e,this.formattedVal=this.strFormatted(this.val,this.activeMask),this.charCode=0,this.charSymbol=0,this.caretMoveFlag=!1,this.selectedSubstr="",this.endPos=0}}}};t.fn.lMask=function(a){return e[a]?e[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void t.error("Метод с именем "+a+" не существует"):e.init.apply(this,arguments)}}(jQuery);